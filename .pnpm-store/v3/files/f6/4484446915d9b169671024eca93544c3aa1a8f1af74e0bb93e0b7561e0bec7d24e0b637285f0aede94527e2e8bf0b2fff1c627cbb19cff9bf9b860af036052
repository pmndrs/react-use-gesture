"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),r=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),t=require("three"),n=require("react"),u=require("@react-three/fiber"),o=require("react-merge-refs"),i=require("../helpers/Position.cjs.js");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("@babel/runtime/helpers/inheritsLoose");var l,f=a(e),s=a(r),d=c(t),b=c(n),m=a(o),p=b.createContext(null),h=new d.Vector3,y=new d.Color;var v=b.forwardRef((function(e,r){var t=e.children,n=s.default(e,["children"]);b.useMemo((function(){return u.extend({Position:i.Position})}),[]);var o=b.useRef(),a=b.useContext(p).subscribe;return b.useLayoutEffect((function(){return a(o)}),[]),b.createElement("position",f.default({matrixAutoUpdate:!1,ref:m.default([r,o])},n),t)}));exports.Point=v,exports.Points=function(e){var r=e.children,t=e.range,n=e.limit,o=void 0===n?1e3:n,i=s.default(e,["children","range","limit"]),a=b.useRef(null),c=b.useState([]),d=c[0],m=c[1],v=b.useState((function(){var e=[].concat(new Array(3*o)).map((function(){return 0})),r=[].concat(new Array(3*o)).map((function(){return 1}));return[new Float32Array(e),new Float32Array(r)]}))[0],g=v[0],j=v[1];b.useLayoutEffect((function(){a.current.geometry.drawRange.count=Math.min(o,void 0!==t?t:o,d.length)}),[d,t]),u.useFrame((function(){for(l=0;l<d.length;l++)d[l].current.updateMatrix(),d[l].current.matrixWorldNeedsUpdate=!1,d[l].current.getWorldPosition(h),h.x===g[3*l]&&h.y===g[3*l+1]&&h.z===g[3*l+2]||(h.toArray(g,3*l),a.current.geometry.attributes.position.needsUpdate=!0),d[l].current.color.equals(y.fromArray(j,3*l))||(d[l].current.color.toArray(j,3*l),a.current.geometry.attributes.color.needsUpdate=!0)}));var x=b.useMemo((function(){var e={};for(l=0;l<d.length;l++){var r;Object.assign(e,null==(r=d[l].current)?void 0:r.__r3f.handlers)}return Object.keys(e).reduce((function(e,r){var t;return f.default({},e,((t={})[r]=function(e){var t,n,u;return null==(t=d[e.index].current)||null==(n=t.__r3f)||null==(u=n.handlers)?void 0:u[r](e)},t))}),{})}),[d]),O=b.useMemo((function(){return{subscribe:function(e){return m((function(r){return[].concat(r,[e])})),function(){return m((function(r){return r.filter((function(r){return r.current!==e.current}))}))}}}}),[]);return b.createElement("points",f.default({ref:a},x,i),b.createElement("bufferGeometry",null,b.createElement("bufferAttribute",{attachObject:["attributes","position"],count:g.length/3,array:g,itemSize:3}),b.createElement("bufferAttribute",{attachObject:["attributes","color"],count:j.length/3,array:j,itemSize:3})),b.createElement(p.Provider,{value:O},r))};
